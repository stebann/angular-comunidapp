<div class="admin-usuarios-container">
  <app-search-header
    placeholder="Buscar usuarios por nombre, email o teléfono..."
    [(searchTerm)]="searchTerm"
  >
    <app-button
      type="outline-primary"
      size="sm"
      icon="pi pi-filter"
      (clicked)="openFilters()"
    >
      Filtros
    </app-button>
  </app-search-header>

  <div class="content-area">
    <div
      *ngIf="usuariosFiltrados.length > 0; else noUsuarios"
      class="usuarios-table"
    >
      <!-- Header de tabla -->
      <div class="table-header">
        <div class="col-avatar"></div>
        <div class="col-nombre">Nombre</div>
        <div class="col-usuario">Usuario</div>
        <div class="col-email">Email</div>
        <div class="col-telefono">Teléfono</div>
        <div class="col-rating">Rating</div>
        <div class="col-rol">Rol</div>
        <div class="col-acciones">Acciones</div>
      </div>

      <!-- Filas de usuarios -->
      <div *ngFor="let usuario of usuariosFiltrados" class="table-row">
        <div class="col-avatar">
          <img
            *ngIf="usuario.avatarUrl"
            [src]="usuario.avatarUrl"
            [alt]="usuario.nombreCompleto"
            class="avatar"
          />
          <div *ngIf="!usuario.avatarUrl" class="avatar-placeholder">
            {{ usuario.nombreCompleto.charAt(0).toUpperCase() }}
          </div>
        </div>

        <div class="col-nombre">
          <span class="nombre">{{ usuario.nombreCompleto }}</span>
        </div>

        <div class="col-usuario">
          <span class="usuario-name">{{ usuario.nombreUsuario }}</span>
        </div>

        <div class="col-email">
          <span class="email">{{ usuario.email }}</span>
        </div>

        <div class="col-telefono">
          <span class="telefono">{{ usuario.telefono }}</span>
        </div>

        <div class="col-rating">
          <span class="rating">
            <i class="pi pi-star-fill"></i> {{ usuario.ratingPromedio }}
          </span>
        </div>

        <div class="col-rol">
          <span class="rol-badge" [class]="usuario.rol.nombre.toLowerCase()">
            {{ usuario.rol.nombre }}
          </span>
        </div>

        <div class="col-acciones">
          <app-opciones [items]="getOpcionesFor(usuario)"></app-opciones>
        </div>
      </div>
    </div>

    <ng-template #noUsuarios>
      <app-empty-placeholder
        icon="users"
        title="No hay usuarios disponibles"
        description="Prueba con otros filtros de búsqueda"
      ></app-empty-placeholder>
    </ng-template>
  </div>
</div>

<app-generic-filter
  [form]="filtro"
  [(isOpen)]="isOpen"
  (applyFilter)="onFiltersApplied()"
>
  <app-dropdown-field
    label="Rol"
    formControlName="rol"
    [options]="rolesOptionsForDropdown"
  ></app-dropdown-field>
</app-generic-filter>
