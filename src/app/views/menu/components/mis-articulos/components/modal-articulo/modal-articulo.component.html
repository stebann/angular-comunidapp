<div class="modal-articulo">
  <div class="modal-content">
    <div class="left">
      <h3 class="section-title">Imágenes del Artículo</h3>

      <!-- Carrusel principal -->
      <div
        class="carousel-container"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <input
          #fileInput
          type="file"
          accept="image/*"
          multiple
          (change)="onArchivosSeleccionados($event)"
          hidden
        />

        <ng-container *ngIf="previewImages.length; else emptyState">
          <div class="carousel-main" [class.drag-over]="isDragOver">
            <img
              [src]="previewImages[currentImageIndex]"
              alt="Imagen actual"
              class="main-image"
            />

            <!-- Botones de navegación -->
            <button
              type="button"
              class="nav-btn prev-btn"
              [disabled]="currentImageIndex === 0"
              (click)="anteriorImagen()"
            >
              <i class="pi pi-chevron-left"></i>
            </button>

            <button
              type="button"
              class="nav-btn next-btn"
              [disabled]="currentImageIndex === previewImages.length - 1"
              (click)="siguienteImagen()"
            >
              <i class="pi pi-chevron-right"></i>
            </button>

            <!-- Contador -->
            <div class="image-counter">
              {{ currentImageIndex + 1 }} / {{ previewImages.length }}
              <small class="max-photos-hint" *ngIf="previewImages.length >= 5"
                >(Máximo 5 fotos)</small
              >
            </div>

            <!-- Botón eliminar -->
            <button
              type="button"
              class="delete-btn"
              (click)="eliminarImagen(currentImageIndex)"
            >
              <i class="pi pi-times"></i>
            </button>
          </div>
        </ng-container>

        <ng-template #emptyState>
          <div
            class="empty-state"
            [class.drag-over]="isDragOver"
            (click)="abrirSelectorArchivos()"
          >
            <i class="pi pi-upload"></i>
            <p>Arrastra imágenes aquí<br />o haz clic para seleccionar</p>
          </div>
        </ng-template>

        <!-- Botón para agregar imágenes (siempre visible) -->
        <button
          type="button"
          class="add-images-btn"
          (click)="abrirSelectorArchivos()"
          [disabled]="previewImages.length >= 5"
        >
          <i class="pi pi-plus"></i>
          Agregar Imágenes ({{ previewImages.length }}/5)
        </button>
      </div>
    </div>

    <div class="right">
      <form [formGroup]="form" class="form-grid">
        <app-input-field
          label="Nombre del Artículo"
          formControlName="titulo"
          placeholder="Ej: Bicicleta de montaña"
          [required]="true"
        >
        </app-input-field>

        <div class="row-fields">
          <div class="field-group">
            <app-dropdown-field
              label="Categoría"
              formControlName="categoriaCodigo"
              [options]="categorias"
              [required]="true"
              placeholder="Selecciona una categoría"
            >
            </app-dropdown-field>
          </div>

          <div class="field-group">
            <app-dropdown-field
              label="Condición"
              formControlName="condicionCodigo"
              [options]="condiciones"
              [required]="true"
              placeholder="Selecciona la condición"
            >
            </app-dropdown-field>
          </div>
        </div>

        <div class="row-fields">
          <div class="field-group">
            <app-dropdown-field
              label="Tipo de Transacción"
              formControlName="tipoTransaccionCodigo"
              [options]="tiposTransaccion"
              [required]="true"
              placeholder="Selecciona el tipo"
            >
            </app-dropdown-field>
          </div>

          <div
            class="field-group"
            *ngIf="
              form.get('tipoTransaccionCodigo')?.value === tipoTransaccionVenta
            "
          >
            <app-input-number-field
              label="Precio"
              formControlName="precio"
              [required]="true"
              placeholder="0"
              [min]="0"
            >
            </app-input-number-field>
          </div>
        </div>

        <app-textarea-field
          label="Descripción"
          [rows]="6"
          [required]="true"
          formControlName="descripcion"
          placeholder="Describe el artículo, su estado y características..."
        ></app-textarea-field>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <app-button type="outline-primary" (click)="cerrarModal()">
      Cancelar
    </app-button>
    <app-button
      type="primary"
      (clicked)="crearArticulo()"
      [disabled]="!canSave"
    >
      Guardar
    </app-button>
  </div>
</div>
