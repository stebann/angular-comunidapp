<div class="solicitud-comercio-modal">
  <div class="modal-content">
    <div class="left">
      <h3 class="section-title">Imágenes del Comercio</h3>

      <div
        class="carousel-container"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <input
          #fileInput
          type="file"
          accept="image/*"
          multiple
          (change)="onArchivosSeleccionados($event)"
          hidden
        />

        <ng-container *ngIf="previewImages.length; else emptyState">
          <div class="carousel-main" [class.drag-over]="isDragOver">
            <img
              [src]="previewImages[currentImageIndex]"
              alt="Imagen actual"
              class="main-image"
            />

            <button
              type="button"
              class="nav-btn prev-btn"
              [disabled]="currentImageIndex === 0"
              (click)="anteriorImagen()"
            >
              <i class="pi pi-chevron-left"></i>
            </button>

            <button
              type="button"
              class="nav-btn next-btn"
              [disabled]="currentImageIndex === previewImages.length - 1"
              (click)="siguienteImagen()"
            >
              <i class="pi pi-chevron-right"></i>
            </button>

            <div class="image-counter">
              {{ currentImageIndex + 1 }} / {{ previewImages.length }}
            </div>

            <button
              type="button"
              class="delete-btn"
              (click)="eliminarImagen(currentImageIndex)"
            >
              <i class="pi pi-times"></i>
            </button>
          </div>
        </ng-container>

        <ng-template #emptyState>
          <div
            class="empty-state"
            [class.drag-over]="isDragOver"
            (click)="abrirSelectorArchivos()"
          >
            <i class="pi pi-upload"></i>
            <p>Arrastra imágenes aquí<br />o haz clic para seleccionar</p>
          </div>
        </ng-template>

        <button
          type="button"
          class="add-images-btn"
          (click)="abrirSelectorArchivos()"
          [disabled]="previewImages.length >= 5"
        >
          <i class="pi pi-plus"></i>
          Agregar Imágenes ({{ previewImages.length }}/5)
        </button>
      </div>
    </div>

    <div class="right">
      <form [formGroup]="comercioForm" class="form-grid">
        <app-input-field
          formControlName="nombre"
          label="Nombre del Comercio"
          placeholder="Ej: Ferretería El Tornillo"
          [required]="true"
          class="full-width"
        ></app-input-field>

        <app-dropdown-field
          formControlName="categoriaId"
          label="Categoría"
          placeholder="Selecciona una categoría"
          [options]="categoriasComercios"
          [required]="true"
        ></app-dropdown-field>

        <app-input-field
          formControlName="telefono"
          label="Teléfono"
          placeholder="Ej: (1) 555 1234"
          type="tel"
          [required]="true"
        ></app-input-field>

        <app-input-field
          formControlName="direccion"
          label="Dirección"
          placeholder="Ej: Calle 123 #45-67"
          [required]="false"
          class="full-width"
        ></app-input-field>

        <app-textarea-field
          formControlName="descripcion"
          label="Descripción"
          placeholder="Describe tu comercio..."
          [rows]="4"
          [required]="true"
          class="full-width"
        ></app-textarea-field>

        <app-input-field
          formControlName="email"
          label="Email"
          placeholder="Ej: contacto@comercio.com"
          type="email"
          [required]="false"
        ></app-input-field>

        <app-input-field
          formControlName="sitioWeb"
          label="Sitio Web"
          placeholder="Ej: https://www.micomercio.com"
          [required]="false"
        ></app-input-field>

        <app-checkbox
          formControlName="tieneEnvio"
          label="¿Tiene servicio de envío?"
          class="full-width"
        ></app-checkbox>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <app-button
      type="outline-primary"
      (click)="onCancel()"
      [disabled]="isSubmitting"
    >
      Cancelar
    </app-button>
    <app-button
      type="primary"
      (clicked)="onSubmit()"
      [disabled]="!comercioForm.valid || isSubmitting"
    >
      <i class="pi pi-check" *ngIf="!isSubmitting"></i>
      <i class="pi pi-spinner pi-spin" *ngIf="isSubmitting"></i>
      {{ isSubmitting ? "Creando..." : "Crear Comercio" }}
    </app-button>
  </div>
</div>
