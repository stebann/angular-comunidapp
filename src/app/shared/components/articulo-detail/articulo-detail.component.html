<div class="modal-articulo">
  <div class="modal-content-wrapper">
    <!-- Contenido Principal -->
    <div class="modal-content">
      <!-- Columna Izquierda: Imagen -->
      <div class="left-column">
        <ng-container
          *ngIf="
            articulo?.imagenes && (articulo?.imagenes)!.length > 0;
            else emptyState
          "
        >
          <div class="carousel-main" (click)="openImageViewer()">
            <img
              [src]="getImagenSrc(articulo!.imagenes![currentImageIndex])"
              alt="Imagen del artículo"
              class="main-image"
            />
            <button
              type="button"
              class="nav-btn prev-btn"
              [disabled]="!canGoPrev()"
              (click)="prevImage(); $event.stopPropagation()"
              *ngIf="(articulo?.imagenes)!.length > 1"
            >
              <i class="pi pi-chevron-left"></i>
            </button>
            <button
              type="button"
              class="nav-btn next-btn"
              [disabled]="!canGoNext()"
              (click)="nextImage(); $event.stopPropagation()"
              *ngIf="(articulo?.imagenes)!.length > 1"
            >
              <i class="pi pi-chevron-right"></i>
            </button>
            <div class="image-counter" *ngIf="(articulo?.imagenes)!.length > 1">
              {{ currentImageIndex + 1 }} / {{ (articulo?.imagenes)!.length }}
            </div>
          </div>
        </ng-container>

        <ng-template #emptyState>
          <div class="empty-state">
            <i class="pi pi-image"></i>
            <p>Sin fotos disponibles</p>
          </div>
        </ng-template>
      </div>

      <!-- Columna Derecha: Información -->
      <div class="right-column">
        <!-- Título del Artículo -->
        <div class="article-title-section">
          <h3 class="article-title">
            <i class="pi pi-file-edit"></i>
            {{ titulo }}
          </h3>
        </div>

        <div class="divider-small"></div>

        <!-- Descripción -->
        <div class="description-section">
          <h4 class="section-title">
            <i class="pi pi-align-left"></i>
            Descripción
          </h4>
          <p
            class="description-text"
            [pTooltip]="descripcion"
            tooltipPosition="top"
            [showDelay]="500"
            [hideDelay]="300"
          >
            {{ descripcion }}
          </p>
        </div>

        <div class="divider-small"></div>

        <!-- Detalles del Artículo -->
        <div class="details-section">
          <div class="details-compact">
            <div class="detail-item-compact">
              <i class="pi pi-folder"></i>
              <span class="detail-label-compact">Categoría:</span>
              <span class="detail-value-compact">{{ categoriaNombre }}</span>
            </div>
            <div class="detail-item-compact">
              <i class="pi pi-check-circle"></i>
              <span class="detail-label-compact">Condición:</span>
              <span class="detail-value-compact">{{
                articulo?.condicionNombre || "No especificada"
              }}</span>
            </div>
            <div class="detail-item-compact">
              <i class="pi pi-circle-fill"></i>
              <span class="detail-label-compact">Estado:</span>
              <span
                class="detail-value-compact estado-badge"
                [ngClass]="{
                  'estado-disponible':
                    articulo?.estadoArticuloNombre === 'Disponible',
                  'estado-prestado':
                    articulo?.estadoArticuloNombre === 'Prestado',
                  'estado-mantenimiento':
                    articulo?.estadoArticuloNombre === 'En Mantenimiento',
                  'estado-no-disponible': !articulo?.estadoArticuloNombre
                }"
              >
                {{ articulo?.estadoArticuloNombre || "No disponible" }}
              </span>
            </div>
            <div
              class="detail-item-compact"
              *ngIf="
                articulo?.precio !== undefined && articulo?.precio !== null
              "
            >
              <i class="pi pi-dollar"></i>
              <span class="detail-label-compact">Precio:</span>
              <span class="detail-value-compact">{{
                articulo?.precio | currency : "USD" : "symbol" : "1.2-2"
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Usuarios -->
    <div class="usuarios-section">
      <!-- Propietario -->
      <div
        class="usuario-item"
        (click)="verInfoUsuario(articulo?.propietario, 'Propietario')"
        title="Ver información completa"
      >
        <div class="usuario-content">
          <div class="usuario-avatar">
            <img
              *ngIf="articulo?.propietario?.foto"
              [src]="articulo?.propietario?.foto"
              alt="Avatar"
              class="avatar-img"
            />
            <span *ngIf="!articulo?.propietario?.foto" class="avatar-initials">
              {{ getInitials(propietarioNombre) }}
            </span>
          </div>
          <div class="usuario-info">
            <span class="usuario-label">Propietario</span>
            <span class="usuario-nombre">{{ propietarioNombre }}</span>
          </div>
        </div>
        <div class="btn-ver-mas">
          <i class="pi pi-chevron-right"></i>
        </div>
      </div>

      <!-- Solicitante (si existe) -->
      <div
        class="usuario-item"
        *ngIf="tieneSolicitante"
        (click)="verInfoUsuario(articulo?.solicitante, 'Solicitante')"
        title="Ver información completa"
      >
        <div class="usuario-content">
          <div class="usuario-avatar">
            <img
              *ngIf="articulo?.solicitante?.foto"
              [src]="articulo?.solicitante?.foto"
              alt="Avatar"
              class="avatar-img"
            />
            <span *ngIf="!articulo?.solicitante?.foto" class="avatar-initials">
              {{ getInitials(solicitanteNombre) }}
            </span>
          </div>
          <div class="usuario-info">
            <span class="usuario-label">Solicitante</span>
            <span class="usuario-nombre">{{ solicitanteNombre }}</span>
          </div>
        </div>
        <div class="btn-ver-mas">
          <i class="pi pi-chevron-right"></i>
        </div>
      </div>
    </div>

    <!-- Botón Solicitar Artículo -->
    <div class="action-footer" *ngIf="!isLoading && !isOwner && articulo">
      <div class="divider"></div>
      <div class="action-container">
        <app-button
          type="primary"
          icon="pi pi-shopping-cart"
          [disabled]="!estaDisponible"
          (clicked)="solicitarArticulo()"
          >Solicitar Artículo
        </app-button>
      </div>
    </div>
  </div>
</div>
