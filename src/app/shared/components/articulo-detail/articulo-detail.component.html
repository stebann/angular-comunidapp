<div class="articulo-detail-modal">
  <div class="modal-container">
    <!-- Sección izquierda - Galería de imágenes -->
    <div class="left-panel">
      <!-- Carousel de imágenes -->
      <div class="gallery-container">
        <div
          class="gallery"
          *ngIf="articulo?.imagenes && (articulo?.imagenes?.length ?? 0) > 0"
        >
          <img
            [src]="getImagenSrc(articulo!.imagenes![currentImageIndex])"
            [alt]="titulo + ' - imagen ' + (currentImageIndex + 1)"
            class="gallery-image"
            (click)="openImageViewer()"
          />

          <!-- Controles del carousel -->
          <button
            *ngIf="articulo!.imagenes!.length > 1"
            type="button"
            class="gallery-nav prev"
            (click)="prevImage(); $event.stopPropagation()"
            [disabled]="!canGoPrev()"
          >
            <i class="pi pi-chevron-left"></i>
          </button>
          <button
            *ngIf="articulo!.imagenes!.length > 1"
            type="button"
            class="gallery-nav next"
            (click)="nextImage(); $event.stopPropagation()"
            [disabled]="!canGoNext()"
          >
            <i class="pi pi-chevron-right"></i>
          </button>

          <!-- Indicadores de puntos -->
          <div *ngIf="articulo!.imagenes!.length > 1" class="gallery-dots">
            <button
              *ngFor="let imagen of articulo!.imagenes!; let i = index"
              type="button"
              class="dot"
              [class.active]="i === currentImageIndex"
              (click)="currentImageIndex = i; $event.stopPropagation()"
            ></button>
          </div>
        </div>

        <!-- Estado vacío -->
        <div
          *ngIf="
            !articulo?.imagenes ||
            (articulo?.imagenes && (articulo?.imagenes?.length ?? 0) === 0)
          "
          class="empty-gallery"
        >
          <i class="pi pi-image"></i>
          <p>Sin fotos disponibles</p>
        </div>
      </div>

      <!-- Información del artículo -->
      <div class="product-info">
        <h3 class="product-title">{{ titulo }}</h3>
        <div class="category-container">
          <span class="status-label"><i class="fas fa-folder"></i> Categoría:</span>
          <span class="category-value">{{ categoriaNombre }}</span>
        </div>

        <div class="condition-container">
          <span class="status-label"><i class="fas fa-shield-alt"></i> Condición:</span>
          <span class="condition-pill">
            {{ articulo?.condicionNombre || "No especificada" }}
          </span>
        </div>

        <div
          class="price-container"
          *ngIf="articulo?.precio !== undefined && articulo?.precio !== null"
        >
          <span class="status-label"><i class="fas fa-money-bill-wave"></i> Precio:</span>
          <span class="price-value">
            {{ articulo!.precio! | currency : "USD" : "symbol" : "1.2-2" }}
          </span>
        </div>
      </div>
    </div>

    <!-- Sección derecha - Detalles del artículo -->
    <div class="right-panel">
      <!-- Contenido scrolleable -->
      <div class="content-scrollable">
        <!-- Mensaje de solicitud -->
        <div class="message-section" *ngIf="descripcion">
          <div class="message-header">
            <h4 class="section-title">Descripción</h4>
            <div class="status-container">
              <span
                class="status-pill"
                [ngClass]="{
                  'estado-disponible':
                    articulo?.estadoArticuloNombre === 'Disponible',
                  'estado-prestado': articulo?.estadoArticuloNombre === 'Prestado',
                  'estado-no-disponible':
                    articulo?.estadoArticuloNombre !== 'Disponible' && articulo?.estadoArticuloNombre !== 'Prestado'
                }"
              >
                {{ articulo?.estadoArticuloNombre || "No disponible" }}
              </span>
            </div>
          </div>
          <div class="message-box">
            <p class="message-text">{{ descripcion }}</p>
          </div>
        </div>

        <!-- Información del propietario -->
        <div class="owner-section" *ngIf="articulo?.propietario">
          <h4 class="section-title">Propietario</h4>
          <div class="owner-content">
            <div class="user-card">
              <div class="user-avatar">
                <img
                  *ngIf="articulo?.propietario?.foto"
                  [src]="articulo!.propietario!.foto"
                  alt="Avatar"
                  class="avatar-img"
                />
                <span
                  *ngIf="!articulo?.propietario?.foto"
                  class="avatar-initials"
                >
                  {{ getInitials(propietarioNombre) }}
                </span>
              </div>
              <div class="user-details">
                <h5 class="user-name">{{ propietarioNombre }}</h5>
                <div class="user-info-grid">
                  <div class="info-item">
                    <i class="pi pi-envelope"></i>
                    <span>{{ propietarioEmail }}</span>
                  </div>
                  <div class="info-item" *ngIf="propietarioTelefono">
                    <i class="pi pi-phone"></i>
                    <span>{{ propietarioTelefono }}</span>
                  </div>
                  <div class="info-item full-width" *ngIf="propietarioDireccion">
                    <i class="pi pi-map-marker"></i>
                    <span>{{ propietarioDireccion }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Información del solicitante (si existe) -->
        <div
          class="applicant-section"
          *ngIf="tieneSolicitante && articulo?.solicitante"
        >
          <h4 class="section-title">Solicitante</h4>
          <div class="applicant-content">
            <div class="user-card">
              <div class="user-avatar">
                <img
                  *ngIf="articulo?.solicitante?.foto"
                  [src]="articulo!.solicitante!.foto"
                  alt="Avatar"
                  class="avatar-img"
                />
                <span
                  *ngIf="!articulo?.solicitante?.foto"
                  class="avatar-initials"
                >
                  {{ getInitials(solicitanteNombre) }}
                </span>
              </div>
              <div class="user-details">
                <h5 class="user-name">{{ solicitanteNombre }}</h5>
                <div class="user-info-grid">
                  <div class="info-item">
                    <i class="pi pi-envelope"></i>
                    <span>{{ solicitanteEmail }}</span>
                  </div>
                  <div class="info-item" *ngIf="solicitanteTelefono">
                    <i class="pi pi-phone"></i>
                    <span>{{ solicitanteTelefono }}</span>
                  </div>
                  <div class="info-item full-width" *ngIf="solicitanteDireccion">
                    <i class="pi pi-map-marker"></i>
                    <span>{{ solicitanteDireccion }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer con acciones -->
      <div class="modal-footer" *ngIf="!isLoading && !isOwner && articulo">
        <app-button
          type="primary"
          size="sm"
          icon="pi pi-shopping-cart"
          [disabled]="!estaDisponible"
          (clicked)="solicitarArticulo()"
        >
          Solicitar Artículo
        </app-button>
      </div>
    </div>
  </div>
</div>
